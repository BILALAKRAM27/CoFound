{% load profile_filters %}
<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <!-- Profile Card -->
    <div class="profile-card text-center">
        {% if user_profile_image_blob %}
            <img src="data:image/jpeg;base64,{{ user_profile_image_blob|b64encode_blob }}" 
                 alt="{{ user.get_full_name }}" class="profile-avatar mb-3">
        {% elif user.is_authenticated and user.role == 'entrepreneur' and user.entrepreneur_profile.image %}
            <img src="data:image/jpeg;base64,{{ user.entrepreneur_profile.image|b64encode_blob }}" 
                 alt="{{ user.get_full_name }}" class="profile-avatar mb-3">
        {% elif user.is_authenticated and user.role == 'investor' and user.investor_profile.image %}
            <img src="data:image/jpeg;base64,{{ user.investor_profile.image|b64encode_blob }}" 
                 alt="{{ user.get_full_name }}" class="profile-avatar mb-3">
        {% else %}
            <i class="bi bi-person-circle fs-1 text-white mb-3 d-block"></i>
        {% endif %}
        {% if user.is_authenticated %}
            <h6 class="mb-1">{{ user.get_full_name|default:user.email }}</h6>
        {% endif %}
        <small class="opacity-75">
            {% if user.role == 'entrepreneur' %}
                {% if user.entrepreneur_profile.company_name %}
                    {{ user.entrepreneur_profile.company_name }}
                {% else %}
                    Entrepreneur
                {% endif %}
            {% else %}
                {% if user.investor_profile.firm_name %}
                    {{ user.investor_profile.firm_name }}
                {% else %}
                    Investor
                {% endif %}
            {% endif %}
        </small>
        <div class="d-flex justify-content-around mt-3 pt-3 border-top border-light border-opacity-25">
            <div>
                <strong class="d-block">{{ sidebar_connections_count|default:'0' }}</strong>
                <small class="opacity-75">Connections</small>
            </div>
            <div>
                <strong class="d-block">{{ sidebar_posts_count|default:'0' }}</strong>
                <small class="opacity-75">Posts</small>
            </div>
            <div>
                <strong class="d-block">{{ sidebar_profile_views|default:'0' }}</strong>
                <small class="opacity-75">Views</small>
            </div>
        </div>
    </div>

    <!-- Navigation Links -->
    <nav class="sidebar-nav">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" 
                   href="{% url 'home' %}">
                    <i class="fa fa-home" aria-hidden="true"></i>Home
                </a>
            </li>
            <li class="nav-item">
                {% if user.is_authenticated and user.role == 'entrepreneur' %}
                    <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' and request.resolver_match.namespace == 'entrepreneurs' %}active{% endif %}" 
                       href="{% url 'entrepreneurs:dashboard' %}">
                       <i class="fa fa-line-chart" aria-hidden="true"></i>Dashboard
                    </a>
                {% else %}
                    <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' and request.resolver_match.namespace == 'investors' %}active{% endif %}" 
                       href="{% url 'investors:dashboard' %}">
                       <i class="fa fa-line-chart" aria-hidden="true"></i>Dashboard
                    </a>
                {% endif %}
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %}" 
                   href="{% if user.role == 'entrepreneur' %}{% url 'entrepreneurs:profile' %}{% else %}{% url 'investors:profile' %}{% endif %}">
                    <i class="bi bi-person"></i>My Profile
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'funding_rounds_list' %}active{% endif %}" href="{% url 'investors:funding_rounds_list' %}">
                    <i class="fa fa-handshake-o" aria-hidden="true"></i>Collaboration Requests
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'my_posts' %}active{% endif %}" href="{% url 'investors:my_posts' %}">
                    <i class="fa fa-map-signs" aria-hidden="true"></i>My posts
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'saved_posts' %}active{% endif %}" href="{% url 'investors:saved_posts' %}">
                    <i class="bi bi-bookmark"></i>Saved Posts
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'my_network' %}active{% endif %}" href="{% url 'investors:my_network' %}">
                    <i class="bi bi-people"></i>My Network
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link {% if 'sign-out' in request.path %}active{% endif %}" href="{% url 'investors:logout' %}" style="color: rgb(251, 71, 71);">
                    <i class="fa fa-sign-out" aria-hidden="true"></i>Sign-out
                </a>
            </li>
        </ul>
    </nav>
</aside>
