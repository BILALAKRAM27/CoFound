{% extends 'base.html' %}
{% load static %}
{% load profile_filters %}

{% block title %}Meeting Calendar - CoFound{% endblock %}

{% block styles %}
<style>
.meeting-list-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
}

.meeting-item {
    background: #e3f2fd;
    border-left: 3px solid #2196f3;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.meeting-item:hover {
    background: #bbdefb;
    transform: translateX(2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.meeting-item.confirmed {
    background: #e8f5e8;
    border-left-color: #4caf50;
}

.meeting-item.pending {
    background: #fff3e0;
    border-left-color: #ff9800;
}

.meeting-item.declined {
    background: #ffebee;
    border-left-color: #f44336;
}

.meeting-item.cancelled {
    background: #f5f5f5;
    border-left-color: #9e9e9e;
}

.meeting-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.meeting-time {
    font-weight: 600;
    color: #1976d2;
    font-size: 1.1rem;
}

.meeting-status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.meeting-status-badge.pending {
    background: #fff3cd;
    color: #856404;
}

.meeting-status-badge.confirmed {
    background: #d1edff;
    color: #0c5460;
}

.meeting-status-badge.declined {
    background: #f8d7da;
    color: #721c24;
}

.meeting-status-badge.cancelled {
    background: #e2e3e5;
    color: #383d41;
}

.meeting-title {
    color: #424242;
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

.meeting-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.meeting-detail-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #666;
    font-size: 0.9rem;
}

.meeting-detail-item i {
    color: #1976d2;
    width: 16px;
}

.meeting-participant {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.meeting-location, .meeting-description {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.meeting-description {
    font-style: italic;
    color: #888;
}

.meeting-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

.meeting-actions .btn {
    padding: 0.25rem 0.75rem;
    font-size: 0.8rem;
}

@media (max-width: 768px) {
    .meeting-details {
        grid-template-columns: 1fr;
    }
    
    .meeting-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-calendar3 me-2"></i>All Meetings</h2>
                <div>
                    <a href="{% url 'entrepreneurs:meetings' %}" class="btn btn-outline-primary me-2">
                        <i class="bi bi-list me-2"></i>List View
                    </a>
                </div>
            </div>

            <div class="meeting-list-container p-4">
                {% if meetings_by_date %}
                    {% for date_key, meetings in meetings_by_date.items %}
                        <div class="date-section mb-4">
                            <h4 class="text-primary mb-3">
                                <i class="bi bi-calendar-date me-2"></i>
                                {{ date_key|date:"l, F j, Y" }}
                            </h4>
                            
                            {% for meeting in meetings %}
                                <div class="meeting-item {{ meeting.status }}">
                                    <div class="meeting-header">
                                        <div class="meeting-time">
                                            <i class="bi bi-clock me-2"></i>{{ meeting.time|time:"g:i A" }}
                                        </div>
                                        <span class="meeting-status-badge {{ meeting.status }}">
                                            {{ meeting.status|title }}
                                        </span>
                                    </div>
                                    
                                    <div class="meeting-title">
                                        <i class="bi bi-calendar-event me-2"></i>{{ meeting.title }}
                                    </div>
                                    
                                    <div class="meeting-details">
                                        <div class="meeting-detail-item">
                                            <i class="bi bi-clock-history"></i>
                                            <span>{{ meeting.duration }} minutes</span>
                                        </div>
                                        <div class="meeting-detail-item">
                                            <i class="bi bi-tag"></i>
                                            <span>{{ meeting.get_meeting_type_display }}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="meeting-participant">
                                        {% if meeting.organizer == request.user %}
                                            <span class="text-success fw-bold">You</span> with 
                                            <span class="fw-bold">{{ meeting.participant.get_full_name }}</span>
                                        {% else %}
                                            <span class="fw-bold">{{ meeting.organizer.get_full_name }}</span> with 
                                            <span class="text-success fw-bold">You</span>
                                        {% endif %}
                                    </div>
                                    
                                    {% if meeting.location %}
                                        <div class="meeting-location">
                                            <i class="bi bi-geo-alt me-2"></i>{{ meeting.location }}
                                        </div>
                                    {% endif %}
                                    
                                    {% if meeting.description %}
                                        <div class="meeting-description">
                                            <i class="bi bi-info-circle me-2"></i>{{ meeting.description }}
                                        </div>
                                    {% endif %}
                                    
                                    {% if meeting.status == 'pending' %}
                                        <div class="meeting-actions">
                                            {% if meeting.participant == request.user %}
                                                <a href="{% url 'entrepreneurs:respond_to_meeting' meeting.id 'accept' %}" class="btn btn-success btn-sm">
                                                    <i class="bi bi-check-circle me-1"></i>Accept
                                                </a>
                                                <a href="{% url 'entrepreneurs:respond_to_meeting' meeting.id 'reject' %}" class="btn btn-danger btn-sm">
                                                    <i class="bi bi-x-circle me-1"></i>Decline
                                                </a>
                                            {% endif %}
                                            {% if meeting.organizer == request.user %}
                                                <a href="{% url 'entrepreneurs:cancel_meeting' meeting.id %}" class="btn btn-warning btn-sm">
                                                    <i class="bi bi-x-circle me-1"></i>Cancel
                                                </a>
                                            {% endif %}
                                        </div>
                                    {% elif meeting.status == 'confirmed' %}
                                        <div class="meeting-actions">
                                            {% if meeting.organizer == request.user %}
                                                <a href="{% url 'entrepreneurs:cancel_meeting' meeting.id %}" class="btn btn-warning btn-sm">
                                                    <i class="bi bi-x-circle me-1"></i>Cancel
                                                </a>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x display-1 text-muted"></i>
                        <h4 class="text-muted mt-3">No meetings scheduled</h4>
                        <p class="text-muted">You don't have any meetings scheduled yet.</p>
                        <a href="{% url 'home' %}" class="btn btn-primary">
                            <i class="bi bi-search me-2"></i>Find People to Meet
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
